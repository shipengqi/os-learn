<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Shell # shell 是 Linux 的命令解释器，解释用户对操作系统的操作。CentOS 默认使用的 shell 是 bash。例如，执行 ls 命令时，会先被 shell 对命令和参数进行解释，再交给内核执行。
/bin/bash 的位置是用于配置登录后的默认交互命令行的，不像 Windows，登录进去是界面，其实就是 explorer.exe。而 Linux 登录后的交互命令行是一个解析脚本的程序，默认是 /bin/bash。
执行命令的方式：
bash ./test.sh 创建一个子进程来运行 test.sh ./test.sh 创建一个子进程来运行 test.sh，需要 Sha-Bang ，也就是脚本文件开头的 #!/bin/bash 来判断使用哪种 shell。 source ./test.sh 在当前进程运行 test.sh。也就是说 test.sh 里面执行的命令会影响当前 bash 进程。比如 test.sh 里面只有一行命令为 cd /var ，当前进程会切换到 /var。如果是 bash ./test.sh 当前 bash 就不会切换目录，只是在子进程切换了目录。 . test.sh . 是 source 的另一种写法。 如果希望脚本对当前运行环境产生影响，就使用 source 来执行。
Linux 启动过程 # BIOS （基本输入输出系统）引导，在主板上执行，选择引导介质 MBR 硬盘引导 BootLoader(grub) 启动和引导 Linux 内核，确定内核版本 kernel systemd 系统初始化 shell 管道 # 管道是进程间通信的一种方式。| 管道符，可以将前一个命令的结果传递给后面的命令。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Shell"><meta property="og:description" content="Shell # shell 是 Linux 的命令解释器，解释用户对操作系统的操作。CentOS 默认使用的 shell 是 bash。例如，执行 ls 命令时，会先被 shell 对命令和参数进行解释，再交给内核执行。
/bin/bash 的位置是用于配置登录后的默认交互命令行的，不像 Windows，登录进去是界面，其实就是 explorer.exe。而 Linux 登录后的交互命令行是一个解析脚本的程序，默认是 /bin/bash。
执行命令的方式：
bash ./test.sh 创建一个子进程来运行 test.sh ./test.sh 创建一个子进程来运行 test.sh，需要 Sha-Bang ，也就是脚本文件开头的 #!/bin/bash 来判断使用哪种 shell。 source ./test.sh 在当前进程运行 test.sh。也就是说 test.sh 里面执行的命令会影响当前 bash 进程。比如 test.sh 里面只有一行命令为 cd /var ，当前进程会切换到 /var。如果是 bash ./test.sh 当前 bash 就不会切换目录，只是在子进程切换了目录。 . test.sh . 是 source 的另一种写法。 如果希望脚本对当前运行环境产生影响，就使用 source 来执行。
Linux 启动过程 # BIOS （基本输入输出系统）引导，在主板上执行，选择引导介质 MBR 硬盘引导 BootLoader(grub) 启动和引导 Linux 内核，确定内核版本 kernel systemd 系统初始化 shell 管道 # 管道是进程间通信的一种方式。| 管道符，可以将前一个命令的结果传递给后面的命令。"><meta property="og:type" content="article"><meta property="og:url" content="http://shipengqi.github.io/os-learn/docs/commands/14_shell/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-11-15T17:26:03+08:00"><title>Shell | OS Learning</title><link rel=manifest href=/os-learn/manifest.json><link rel=icon href=/os-learn/favicon.png><link rel=stylesheet href=/os-learn/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/os-learn/flexsearch.min.js></script>
<script defer src=/os-learn/en.search.min.9da2651f3362f085ba92fedcac79d3065ce93b32c3817feded7d23b6337f4ee9.js integrity="sha256-naJlHzNi8IW6kv7crHnTBlzpOzLDgX/t7X0jtjN/Tuk=" crossorigin=anonymous></script>
<script defer src=/os-learn/sw.min.73e4e12d3b3ff9b5bd6410a479234d8908ebac0e4d11ef31f508715b8e7f7c7d.js integrity="sha256-c+ThLTs/+bW9ZBCkeSNNiQjrrA5NEe8x9QhxW45/fH0=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/os-learn/><span>OS Learning</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://shipengqi.github.io/ target=_blank rel=noopener>Blog</a></li><li><a href=https://github.com/shipengqi/os-learn target=_blank rel=noopener>Github</a></li></ul><ul><li><span>Linux 常用命令</span><ul><li><a href=/os-learn/docs/commands/01_view_text/>查看文件内容</a></li><li><a href=/os-learn/docs/commands/02_tar/>打包压缩</a></li><li><a href=/os-learn/docs/commands/03_vim/>Vim</a></li><li><a href=/os-learn/docs/commands/04_user_manage/>用户管理</a></li><li><a href=/os-learn/docs/commands/05_file_perm/>文件权限</a></li><li><a href=/os-learn/docs/commands/06_network/>网络管理</a></li><li><a href=/os-learn/docs/commands/07_package_manage/>包管理器</a></li><li><a href=/os-learn/docs/commands/08_grup/>grup</a></li><li><a href=/os-learn/docs/commands/09_process/>进程管理</a></li><li><a href=/os-learn/docs/commands/10_systemd/>systemctl</a></li><li><a href=/os-learn/docs/commands/11_selinux/>SELinux</a></li><li><a href=/os-learn/docs/commands/12_mem_disk/>内存和磁盘</a></li><li><a href=/os-learn/docs/commands/13_sar/>查看系统状态</a></li><li><a href=/os-learn/docs/commands/14_shell/ class=active>Shell</a></li><li><a href=/os-learn/docs/commands/15_script_priority/>脚本控制</a></li><li><a href=/os-learn/docs/commands/16_text_operation/>操作文本</a></li><li><a href=/os-learn/docs/commands/17_firewall/>防火墙</a></li><li><a href=/os-learn/docs/commands/18_ssh/>SSH</a></li><li><a href=/os-learn/docs/commands/19_ftp/>FTP</a></li><li><a href=/os-learn/docs/commands/20_nfs/>NFS</a></li><li><a href=/os-learn/docs/commands/21_dns/>DNS</a></li><li><a href=/os-learn/docs/commands/22_kernel_upgrade/>内核升级</a></li><li><a href=/os-learn/docs/commands/23_pty_tty/>pty</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/os-learn/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Shell</strong>
<label for=toc-control><img src=/os-learn/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#shell>Shell</a><ul><li><a href=#linux-启动过程>Linux 启动过程</a></li><li><a href=#管道>管道</a></li><li><a href=#重定向>重定向</a><ul><li><a href=#输入重定向>输入重定向</a></li><li><a href=#输出重定向>输出重定向</a></li></ul></li><li><a href=#变量>变量</a></li><li><a href=#环境变量>环境变量</a></li><li><a href=#环境变量配置文件>环境变量配置文件</a></li><li><a href=#数组>数组</a></li><li><a href=#转义和引用>转义和引用</a></li><li><a href=#运算符>运算符</a></li><li><a href=#特殊符号>特殊符号</a></li><li><a href=#判断>判断</a><ul><li><a href=#if>if</a></li><li><a href=#分支>分支</a></li></ul></li><li><a href=#循环>循环</a><ul><li><a href=#for>for</a></li><li><a href=#while>while</a></li><li><a href=#until>until</a></li><li><a href=#嵌套循环>嵌套循环</a></li><li><a href=#使用循环处理命令行参数>使用循环处理命令行参数</a></li></ul></li><li><a href=#函数>函数</a><ul><li><a href=#函数库>函数库</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=shell>Shell
<a class=anchor href=#shell>#</a></h1><p>shell 是 Linux 的命令解释器，解释用户对操作系统的操作。CentOS 默认使用的 shell 是 bash。例如，执行 <code>ls</code> 命令时，会先被 shell 对命令和参数进行解释，再交给内核执行。</p><p><code>/bin/bash</code> 的位置是用于配置登录后的默认交互命令行的，不像 Windows，登录进去是界面，其实就是 <code>explorer.exe</code>。而 Linux 登录后的交互命令行是一个解析脚本的程序，默认是 <code>/bin/bash</code>。</p><p>执行命令的方式：</p><ul><li><code>bash ./test.sh</code> 创建一个子进程来运行 <code>test.sh</code></li><li><code>./test.sh</code> 创建一个子进程来运行 <code>test.sh</code>，需要 <code>Sha-Bang</code> ，也就是脚本文件开头的 <code>#!/bin/bash</code> 来判断使用哪种 shell。</li><li><code>source ./test.sh</code> 在当前进程运行 <code>test.sh</code>。也就是说 <code>test.sh</code> 里面执行的命令会影响当前 bash 进程。比如 <code>test.sh</code> 里面只有一行命令为 <code>cd /var</code> ，当前进程会切换到 <code>/var</code>。如果是 <code>bash ./test.sh</code> 当前 bash 就不会切换目录，只是在子进程切换了目录。</li><li><code>. test.sh</code> <code>.</code> 是 source 的另一种写法。</li></ul><p><strong>如果希望脚本对当前运行环境产生影响，就使用 <code>source</code> 来执行</strong>。</p><h2 id=linux-启动过程>Linux 启动过程
<a class=anchor href=#linux-%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b>#</a></h2><ol><li>BIOS （基本输入输出系统）引导，在主板上执行，选择引导介质</li><li>MBR 硬盘引导</li><li>BootLoader(grub) 启动和引导 Linux 内核，确定内核版本</li><li>kernel</li><li>systemd</li><li>系统初始化</li><li>shell</li></ol><h2 id=管道>管道
<a class=anchor href=#%e7%ae%a1%e9%81%93>#</a></h2><p>管道是进程间通信的一种方式。<code>|</code> 管道符，可以将前一个命令的结果传递给后面的命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># cat | ps -f</span>
</span></span><span style=display:flex><span>UID        PID  PPID  C STIME TTY          TIME CMD
</span></span><span style=display:flex><span>root     <span style=color:#ae81ff>22804</span> <span style=color:#ae81ff>22792</span>  <span style=color:#ae81ff>7</span> 21:52 pts/4    00:00:00 -bash
</span></span><span style=display:flex><span>root     <span style=color:#ae81ff>22848</span> <span style=color:#ae81ff>22804</span>  <span style=color:#ae81ff>0</span> 21:53 pts/4    00:00:00 cat
</span></span><span style=display:flex><span>root     <span style=color:#ae81ff>22849</span> <span style=color:#ae81ff>22804</span>  <span style=color:#ae81ff>0</span> 21:53 pts/4    00:00:00 ps -f
</span></span></code></pre></div><p>管道符会给前后两个命令分别创建子进程，上面的示例 22848 进程对应 <code>cat</code>，22849 进程对应 <code>ps -f</code>。管道符会把第一个进程的输出和第二个进程的输入建立连接。</p><p>打开另一个终端查看进程信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># cd /proc/22848</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky 22848<span style=color:#f92672>]</span><span style=color:#75715e># cd fd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky fd<span style=color:#f92672>]</span><span style=color:#75715e># ls -l</span>
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>lrwx------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>64</span> Sep  <span style=color:#ae81ff>2</span> 21:54 <span style=color:#ae81ff>0</span> -&gt; /dev/pts/4           <span style=color:#75715e># stdin  pts 表示图形终端</span>
</span></span><span style=display:flex><span>l-wx------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>64</span> Sep  <span style=color:#ae81ff>2</span> 21:54 <span style=color:#ae81ff>1</span> -&gt; pipe:<span style=color:#f92672>[</span>14225010<span style=color:#f92672>]</span>      <span style=color:#75715e># stdout pipe 表示管道</span>
</span></span><span style=display:flex><span>lrwx------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>64</span> Sep  <span style=color:#ae81ff>2</span> 21:53 <span style=color:#ae81ff>2</span> -&gt; /dev/pts/4
</span></span></code></pre></div><p>如果第二个进程是一个长时间运行的命令，那么对应的 fd 目录下的 0 ，也就是 stdin，也会指向 <code>pipe:[14225010]</code>。</p><p>注意，管道符会创建子进程来执行命令，也就是说，如果在管道符前后执行 <code>cd</code> 某个目录，父进程是不会切换目录的。</p><h2 id=重定向>重定向
<a class=anchor href=#%e9%87%8d%e5%ae%9a%e5%90%91>#</a></h2><ul><li>一个进程运行时，会默认打开标准输入（一般是通过键盘，终端进行输入），标准输出，标准错误输出（默认输出到终端）三个文件描述符。</li><li>重定向符号其实是把输入和输出和文件建立连接。用文件来代替输入或输出。</li></ul><h3 id=输入重定向>输入重定向
<a class=anchor href=#%e8%be%93%e5%85%a5%e9%87%8d%e5%ae%9a%e5%90%91>#</a></h3><ul><li><code>&lt;</code>，<code>wc -l | /etc/passwd</code> 统计 <code>/etc/passwd</code> 内容的行数。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># read var2 &lt; a.txt</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $var2</span>
</span></span></code></pre></div><p>将 <code>a.txt</code> 内容读入到变量 <code>var2</code>。</p><h3 id=输出重定向>输出重定向
<a class=anchor href=#%e8%be%93%e5%87%ba%e9%87%8d%e5%ae%9a%e5%90%91>#</a></h3><ul><li><code>></code>，将输出到文件前会先清空文件内容。<code>echo 123 > /path/to/a/file</code>。</li><li><code>>></code>，将输出追加到文件。</li><li><code>2></code>，错误重定向，将错误输出到指定文件。</li><li><code>&></code>，标准输出和错误输出到指定文件。</li><li><code>2>&amp;1</code>，把 标准错误输出 重定向到 标准输出，<code>ls a.txt b.txt 1>file.out 2>&amp;1</code> 的正确输出和错误输出都重定向到了 <code>file.out</code> 文件中。</li><li><code>1>&amp;2</code>，把 标准输出 重定向到 标准错误输出</li></ul><h2 id=变量>变量
<a class=anchor href=#%e5%8f%98%e9%87%8f>#</a></h2><p>变量赋值：</p><ul><li><code>a=123</code>，<code>=</code> 左右不能有空格。</li><li><code>let a=10+20</code>，变量可以进行计算。</li><li><code>r=$(ls -l /etc)</code>，<code>$()</code> 可以得到命令结果。<code>` `</code> 反引号也可以得到命令结果。</li><li>如果变量值有空格或者特殊字符，可以包含在 <code>""</code> 或者 <code>''</code> 中。</li></ul><p>默认值，<code>test2=${2-_}</code>，<code>-</code> 好表示当 <code>$2</code> 为空值时，使用 <code>_</code> 为值。</p><p>变量引用：</p><ul><li><code>${变量名}</code>，有些情况下也可以使用 <code>$变量名</code>。</li></ul><p>变量作用范围：</p><ul><li>变量的默认作用范围是当前 shell 进程。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># a=1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># bash # 进入一个新的 shell 子进程</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $a # a 变量的值是空的</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># a=2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># exit</span>
</span></span><span style=display:flex><span>exit
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $a # a 变量的值不会被子进程的赋值改变</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># bash test.sh # bash 打开了一个新的 shell 进程，在 test.sh 中的变量不会作用到父进程</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># source test.sh # 可以使用 source 命令，在当前进程执行 test.sh，使变量在父进程生效</span>
</span></span></code></pre></div><ul><li><code>export</code> 导出变量，<code>export</code> 设置环境变量是暂时的，可以被子进程读取到，比如在一个终端 export 的变量，在这个终端打开的 shell 子进程都可以读取到这个变量。</li><li><code>unset</code> 删除变量，<code>unsert a</code></li></ul><h2 id=环境变量>环境变量
<a class=anchor href=#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f>#</a></h2><p>环境变量，是每个 shell 都可以读取到的变量：</p><ul><li><code>env</code> 查看所有环境变量，<code>env | more</code>。</li><li><code>set</code> 也可以查看环境变量。<ul><li><code>-e</code> 传回值不等于 0，则立即退出 shell。</li><li><code>-u</code> 执行脚本的时候，如果遇到不存在的变量，Bash 默认忽略它。</li><li><code>-x</code> 默认情况下，脚本执行后，只显示运行结果，这个参数可以显示执行的指令及参数。</li><li><code>-o pipefail</code> <code>-e</code> 参数不适用于管道命令。只要管道符最后一个子命令不失败，管道命令总是会执行成功如 <code>foo</code> 是一个不存在的命令，但是 <code>foo | echo $a</code> 这个管道命令会执行成功。<code>-o pipefail</code> 用来解决这种情况，只要一个子命令失败，整个管道命令就失败，脚本就会终止执行。</li></ul></li><li><code>$?</code> 上条命令的返回值，不为 0，表示执行失败。</li><li><code>$$</code> 表示当前进程 PID</li><li><code>$0</code> 当前进程的名称</li><li><code>$PATH</code> 命令路径</li><li><code>$PS1</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>32163</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $0</span>
</span></span><span style=display:flex><span>-bash
</span></span></code></pre></div><p>位置变量：</p><ul><li><code>$1</code> <code>$2</code> &mldr; <code>$n</code> 分别表示第一个参数，第二个，到第 n 个参数。注意<strong>第十个参数，要用 <code>${10}</code></strong>，否则 <code>$</code> 会默认和 <code>1</code> 结合。</li></ul><p><code>test.sh</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;文件名：</span>$0<span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;第一个参数为：</span>$1<span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;第二个参数为：</span>$2<span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;第三个参数为：</span>$3<span style=color:#e6db74>&#34;</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># ./test.sh 1 2 3</span>
</span></span><span style=display:flex><span>文件名：./test.sh
</span></span><span style=display:flex><span>第一个参数为：1
</span></span><span style=display:flex><span>第二个参数为：2
</span></span><span style=display:flex><span>第三个参数为：3
</span></span></code></pre></div><h2 id=环境变量配置文件>环境变量配置文件
<a class=anchor href=#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6>#</a></h2><ol><li><code>/etc/profile</code></li><li><code>/etc/profile.d</code></li><li><code>~/.bash_profile</code></li><li><code>~/.bashrc</code></li><li><code>/etc/bashrc</code></li></ol><p><strong>执行顺序从上到下</strong>。</p><p><strong><code>/etc</code></strong> 目录下的文件对系统中所有用户都永久有效。<strong><code>~</code></strong> 目录下的文件只对某个用户永久有效。</p><p>配置文件分为 <code>bashrc</code> 和 <code>profile</code> 两种，因为登录用户分为两种，login shell 和 no login shell。比如 <code>su - user1</code> 切换了用户和 home 目录，这属于 login shell。login shell 会执行上面所有的配置文件。如果使用 <code>su user1</code> ，那么只会执行两个 bashrc 文件。</p><p>修改可上面的配置文件可以使用 <code>source &lt;filename></code> 使其立即生效。</p><h2 id=数组>数组
<a class=anchor href=#%e6%95%b0%e7%bb%84>#</a></h2><p>定义数组 <code>IPS=( 10.0.0.1 10.0.0.2 10.0.0.3)</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># IPS=( 10.0.0.1 10.0.0.2 10.0.0.3)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo ${IPS[0]}  # 显示执行下标的元素</span>
</span></span><span style=display:flex><span>10.0.0.1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo ${IPS[1]}</span>
</span></span><span style=display:flex><span>10.0.0.2
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo ${IPS[2]}</span>
</span></span><span style=display:flex><span>10.0.0.3
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo ${IPS}    # 显示的是数据第一个元素</span>
</span></span><span style=display:flex><span>10.0.0.3
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo ${IPS[@]}  # 显示数组所有元素</span>
</span></span><span style=display:flex><span>10.0.0.1 10.0.0.2 10.0.0.3
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo ${#IPS[@]}  # 显示数据长度</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>
</span></span></code></pre></div><h2 id=转义和引用>转义和引用
<a class=anchor href=#%e8%bd%ac%e4%b9%89%e5%92%8c%e5%bc%95%e7%94%a8>#</a></h2><p>特殊字符：</p><ul><li><code>#</code> 注释</li><li><code>;</code> 分号</li><li><code>\</code> 转义符<ul><li><code>\n</code> <code>\r</code> <code>\t</code> 字母转义</li><li><code>\$</code> <code>\"</code> <code>\\</code> 非字母转义</li></ul></li><li><code>"</code> <code>'</code> 引号</li></ul><p>引用：</p><ul><li>双引号，不完全引用，中间的内容会进行解释。</li><li>单引号，完全引用，单引号中间是什么就显示什么，不进行解释。</li><li>反引号，可以得到命令结果。和 <code>$()</code> 的功能一样。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># var1=123</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo &#34;$var1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>123</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo &#39;$var1&#39;</span>
</span></span><span style=display:flex><span>$var1
</span></span></code></pre></div><h2 id=运算符>运算符
<a class=anchor href=#%e8%bf%90%e7%ae%97%e7%ac%a6>#</a></h2><ul><li><code>expr</code> 可以用来计算 <code>expr 4 + 5</code> ，但是只支持整数。</li><li>正常的变量赋值，<code>=</code> 右边都被当做字符串，如果右边需要计算可以使用 <code>let</code>，<code>(())</code> 是 <code>let</code> 的简化。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># ((a=4+5))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $a</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># b=4+5</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $b</span>
</span></span><span style=display:flex><span>4+5
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># ((a++))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $a</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>10</span>
</span></span></code></pre></div><h2 id=特殊符号>特殊符号
<a class=anchor href=#%e7%89%b9%e6%ae%8a%e7%ac%a6%e5%8f%b7>#</a></h2><ul><li>引号<ul><li><code>""</code></li><li><code>''</code></li><li>``</li></ul></li><li>括号<ul><li><code>()</code> 打开一个子进程，或者数组定义</li><li><code>$()</code></li><li><code>(())</code> 执行算数运算</li><li><code>[]</code> <code>[[]]</code> 测试，获取数组下标元素 <code>[ 5 -gt 4 ]</code>，<code>[[]]</code> 就可以使用比较运算符 <code>[[ 5 > 4 ]]</code></li><li><code>&lt;></code> 输入输出重定向</li><li><code>{}</code> 输出范围 <code>echo {0..9}</code>，会输出 <code>0 1 2 3 4 5 6 7 8 9</code></li></ul></li><li>运算和逻辑符号<ul><li><code>+</code> <code>-</code> <code>*</code> <code>/</code> <code>%</code></li><li><code>&lt;</code> <code>></code> <code>=</code></li><li><code>&&</code> <code>||</code> <code>!</code></li></ul></li><li>转义符号<ul><li><code>\</code></li></ul></li><li>其他符号<ul><li><code>#</code> 注释</li><li><code>;</code> 命令分隔符，<code>;;</code> case 语句的分隔符要转义</li><li><code>:</code> 空指令</li><li><code>.</code> 和 source 命令相同</li><li><code>~</code> home 目录</li><li><code>,</code> 分隔目录</li><li><code>-</code> 回到上次访问的目录，<code>cd -</code></li><li><code>*</code> 通配符，匹配 0 或多个字符</li><li><code>?</code> 条件测试，通配符 匹配任意一个字符</li><li><code>$</code> 取值符号</li><li><code>|</code> 管道</li><li><code>&</code> 后台运行</li><li><code>_</code> 空格</li></ul></li></ul><h2 id=判断>判断
<a class=anchor href=#%e5%88%a4%e6%96%ad>#</a></h2><ul><li><code>$?</code> 得到命令的执行结果，判断是否为 0，非 0 为不正常退出。使用 <code>exit</code> 来退出程序。<code>exit</code> 会返回出错命令的错误码，也可以自定义错误码 <code>exit &lt;code></code>。</li><li><code>test</code> 命令检查文件或者比较值。测试语句可以简化为 <code>[]</code>。<code>[]</code> 的扩展写法 <code>[[]]</code> 支持 <code>&&</code> <code>||</code> <code>&lt;</code> <code>></code>。<code>test &lt;表达式></code> 简化为 <code>[ 表达式 ]</code>。常用的测试：<ul><li>字符串测试 <code>[ str1 = str2 ]</code> <code>[ str1 != str2 ]</code> <code>[ -z str ]</code> <code>-z</code> 表示字符串长度是否为 0</li><li>整数测试 <code>[ int1 -eq int2 ]</code> <code>-eq</code> 表示等于，<code>-ge</code> 大于等于，<code>gt</code> 大于，<code>le</code> 小于等于，<code>lt</code> 小于，<code>-ne</code> 不等于。<strong><code>[]</code> 做整数判断时，只能使用 <code>-eq</code> 这种形式。想要使用逻辑运算符 <code>&lt;</code> 等，要使用 <code>[[]]</code></strong>。</li><li>文件测试，<code>[ -e file]</code> <code>-e</code> 文件是否存在，<code>-d</code> 文件存在并且是目录，<code>-f</code> 文件存在并且是普通文件，<code>-b</code> 文件存在并且是块文件，<code>-c</code> 文件存在并且是字符设备文件，<code>-x</code> 文件存在并且可执行。</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># test -f /etc/passwd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># test -f /etc/passwd2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># [ -d /etc/ ]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># [ -e /etc/ ]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># [ 5 -gt 4 ]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># [[ 5 -gt 4 ]]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># [ &#34;aaa&#34; = &#34;aaa&#34; ]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky ~<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h3 id=if>if
<a class=anchor href=#if>#</a></h3><p><code>if-then</code> 语句：</p><ul><li><code>if [ 测试条件成立或执行命令返回值为 0 ]</code></li><li><code>then</code> 执行对应的命令</li><li><code>fi</code> 结束</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>ps -ef | grep -c <span style=color:#e6db74>&#34;ssh&#34;</span><span style=color:#66d9ef>)</span> -gt <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span> echo <span style=color:#e6db74>&#34;true&#34;</span>; <span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p><code>if-else</code> 语句：</p><ul><li><code>if [ 测试条件成立 ]</code></li><li><code>then</code> 执行对应的命令</li><li><code>else</code> 测试条件不成立，执行对应的命令</li><li><code>fi</code> 结束</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>ps -ef | grep -c <span style=color:#e6db74>&#34;ssh&#34;</span><span style=color:#66d9ef>)</span> -gt <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;true&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p><code>if-elif-else</code> 语句：</p><ul><li><code>if [ 测试条件成立 ]</code></li><li><code>then</code> 执行对应的命令</li><li><code>elif [ 测试条件成立 ]</code></li><li><code>then</code> 执行对应的命令</li><li><code>else</code> 测试条件不成立，执行对应的命令</li><li><code>fi</code> 结束</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>a<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>b<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $a <span style=color:#f92672>==</span> $b <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>   echo <span style=color:#e6db74>&#34;a 等于 b&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $a -gt $b <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>   echo <span style=color:#e6db74>&#34;a 大于 b&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $a -lt $b <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>   echo <span style=color:#e6db74>&#34;a 小于 b&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>   echo <span style=color:#e6db74>&#34;没有符合的条件&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>嵌套 <code>if</code> 语句：</p><ul><li><code>if [ 测试条件成立 ]</code></li><li><code>then</code> 执行对应的命令<ul><li><code>if [ 测试条件成立 ]</code></li><li><code>then</code> 执行对应的命令</li><li><code>fi</code></li></ul></li><li><code>fi</code> 结束</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>a<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>b<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>c<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $a <span style=color:#f92672>==</span> $b <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;a = b&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $a <span style=color:#f92672>=</span> $c <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;a = c&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><h3 id=分支>分支
<a class=anchor href=#%e5%88%86%e6%94%af>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$<span style=color:#e6db74>变量&#34;</span> in
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;var1&#34;</span> <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      echo <span style=color:#e6db74>&#34;var1&#34;</span> ;;
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;var2&#34;</span> <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      echo <span style=color:#e6db74>&#34;var2&#34;</span> ;;
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;var3&#34;</span>|<span style=color:#e6db74>&#34;var4&#34;</span> <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      echo <span style=color:#e6db74>&#34;var3|var4&#34;</span> ;;
</span></span><span style=display:flex><span>    * <span style=color:#f92672>)</span> <span style=color:#75715e># 匹配其他情况</span>
</span></span><span style=display:flex><span>      echo <span style=color:#e6db74>&#34;*&#34;</span> ;;
</span></span><span style=display:flex><span><span style=color:#66d9ef>esac</span>
</span></span></code></pre></div><h2 id=循环>循环
<a class=anchor href=#%e5%be%aa%e7%8e%af>#</a></h2><h3 id=for>for
<a class=anchor href=#for>#</a></h3><ul><li><code>for 参数 in 列表</code></li><li><code>do</code> 执行对应的命令</li><li><code>done</code> 封闭一个循环</li></ul><p>使用 <code>{}</code> 得到列表：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#f92672>{</span>1..9<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo $i
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#f92672>{</span>1..9<span style=color:#f92672>}</span>; <span style=color:#66d9ef>do</span> echo $i; <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> loop in <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;The value is: </span>$loop<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>使用命令得到列表，如把当前目录后缀为 txt 的文件改为后缀为 text：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> filename in <span style=color:#e6db74>`</span>ls *.txt<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  mv $filename <span style=color:#66d9ef>$(</span>basename $filename .txt<span style=color:#66d9ef>)</span>.text
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p><code>basename</code> 命令可以得到文件名，不包含后缀名。</p><p>C 风格的 for 循环：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span><span style=color:#f92672>((</span>i <span style=color:#f92672>=</span> 1; i &lt;<span style=color:#f92672>=</span> 5; i++<span style=color:#f92672>))</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>  
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$i<span style=color:#e6db74>&#34;</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>  
</span></span></code></pre></div><h3 id=while>while
<a class=anchor href=#while>#</a></h3><ul><li><code>while test测试是否成了</code></li><li><code>do</code> 执行对应的命令</li><li><code>done</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>int<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>((</span> $int&lt;<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> <span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo $int
</span></span><span style=display:flex><span>  let <span style=color:#e6db74>&#34;int++&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>a<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$a<span style=color:#e6db74>&#34;</span> -le <span style=color:#ae81ff>100</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo $a
</span></span><span style=display:flex><span>  <span style=color:#f92672>((</span>a++<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 死循环</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> :
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>  
</span></span></code></pre></div><h3 id=until>until
<a class=anchor href=#until>#</a></h3><p>和 while 相反，循环条件为 false 时执行，为 true 时停止。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>a<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>until</span> <span style=color:#f92672>[</span> ! $a -lt <span style=color:#ae81ff>10</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>   echo $a
</span></span><span style=display:flex><span>   a<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>expr $a + 1<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><h3 id=嵌套循环>嵌套循环
<a class=anchor href=#%e5%b5%8c%e5%a5%97%e5%be%aa%e7%8e%af>#</a></h3><p><code>break</code> 和 <code>continue</code> 语句：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> filename in /etc/profile.d/*.sh
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo $filename
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -x $filename <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    . $filename
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> num in <span style=color:#f92672>{</span>1..9<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $num -eq <span style=color:#ae81ff>5</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    break <span style=color:#75715e># 退出循环</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># continue 跳过当前循环</span>
</span></span><span style=display:flex><span>    echo $num
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>  
</span></span></code></pre></div><h3 id=使用循环处理命令行参数>使用循环处理命令行参数
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e5%be%aa%e7%8e%af%e5%a4%84%e7%90%86%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%8f%82%e6%95%b0>#</a></h3><ul><li>命令行参数可以使用 <code>$1</code> <code>$2</code> .. <code>$n</code> 来获取。</li><li><code>$0</code> 表示当前脚本名称</li><li><code>$*</code> 和 <code>$@</code> 代表所有位置参数。只有在双引号中体现出来。假设在脚本运行时写了三个参数 1、2、3，，则 " * " 等价于 &ldquo;1 2 3&rdquo;（传递了一个参数），而 &ldquo;@&rdquo; 等价于 &ldquo;1&rdquo; &ldquo;2&rdquo; &ldquo;3&rdquo;（传递了三个参数）。</li><li><code>$#</code> 传递到脚本的参数个数</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> pos in $*
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $pos <span style=color:#f92672>=</span> help <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> $# -ge <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo $#
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;do something&#34;</span>
</span></span><span style=display:flex><span>  shift <span style=color:#75715e># 删除第一个参数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><h2 id=函数>函数
<a class=anchor href=#%e5%87%bd%e6%95%b0>#</a></h2><p>定义函数：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>function</span> funcname<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;do something&#34;</span>
</span></span><span style=display:flex><span>  echo $1
</span></span><span style=display:flex><span>  echo $2
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>${</span>10<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>执行函数：<code>funcname</code>。
函数作用范围的变量：<code>local 变量名</code>
函数的参数：<code>$1</code> <code>$2</code> .. <code>$n</code>
返回值：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。 return 后跟数值 n <code>(0-255)</code></p><h3 id=函数库>函数库
<a class=anchor href=#%e5%87%bd%e6%95%b0%e5%ba%93>#</a></h3><p>系统函数库：<code>/etc/init.d/functions</code></p><p>导入系统函数库，执行函数 <code>echo_success</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky init.d<span style=color:#f92672>]</span><span style=color:#75715e># source /etc/init.d/functions</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky init.d<span style=color:#f92672>]</span><span style=color:#75715e># echo_success</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@pooky init.d<span style=color:#f92672>]</span><span style=color:#75715e>#                                       [  OK  ]</span>
</span></span></code></pre></div><p>自定义函数库：使用 <code>source</code> 导入脚本中的函数</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/shipengqi/os-learn/commit/4f49c8bc26ad1442af2b9f5753687f18dc226c1a title='Last modified by shipengqi | November 15, 2023' target=_blank rel=noopener><img src=/os-learn/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 15, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/shipengqi/os-learn/edit/master/content/docs/commands/14_shell.md target=_blank rel=noopener><img src=/os-learn/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#shell>Shell</a><ul><li><a href=#linux-启动过程>Linux 启动过程</a></li><li><a href=#管道>管道</a></li><li><a href=#重定向>重定向</a><ul><li><a href=#输入重定向>输入重定向</a></li><li><a href=#输出重定向>输出重定向</a></li></ul></li><li><a href=#变量>变量</a></li><li><a href=#环境变量>环境变量</a></li><li><a href=#环境变量配置文件>环境变量配置文件</a></li><li><a href=#数组>数组</a></li><li><a href=#转义和引用>转义和引用</a></li><li><a href=#运算符>运算符</a></li><li><a href=#特殊符号>特殊符号</a></li><li><a href=#判断>判断</a><ul><li><a href=#if>if</a></li><li><a href=#分支>分支</a></li></ul></li><li><a href=#循环>循环</a><ul><li><a href=#for>for</a></li><li><a href=#while>while</a></li><li><a href=#until>until</a></li><li><a href=#嵌套循环>嵌套循环</a></li><li><a href=#使用循环处理命令行参数>使用循环处理命令行参数</a></li></ul></li><li><a href=#函数>函数</a><ul><li><a href=#函数库>函数库</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>