<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="网络管理 # net-tools 是 CentOS 7 之前的版本使用的网络管理工具，而 iproute2 是 CentOS 7 之后主推的网络管理工具。
net-tools # net-tools 包括：
ifconfig：网卡配置。 route：网关配置。 netstat：查看网络状态。 iproute2 # ip：包含了 ifconfig 和 route 的功能。 ss：Socket Statistics 的缩写，和 netstat 类似，但是更快更强。 使用网络工具 # ifconfig 查看网卡 # 执行 ifconfig 查看网卡。
一般第一块网卡是 eth0。也可能是：
eno1 板载网卡 ens33 PCI-E 网卡 enp0s3 无法获取物理信息的 PCI-E 网卡 都不匹配就使用 eth0。
配置网卡名称 # 在管理服务器集群时，网卡名称不同，会不好管理。如何配置网卡名称？
首先，网卡命名规则受两个参数影响，分别是 biosdevname 和 net.ifnames。grup 是系统启动时，引导内核的工具。
编辑 /etc/default/grup 文件，在 GRUP_CMDLINE_LINUX 对应的命令后面添加（或修改）参数 biosdevname=0 net.ifnames=0，就可以传递到内核。 /etc/default/grup 需要运行 grup2-mkconfig -o /boot/grup2/grup."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="网络管理"><meta property="og:description" content="网络管理 # net-tools 是 CentOS 7 之前的版本使用的网络管理工具，而 iproute2 是 CentOS 7 之后主推的网络管理工具。
net-tools # net-tools 包括：
ifconfig：网卡配置。 route：网关配置。 netstat：查看网络状态。 iproute2 # ip：包含了 ifconfig 和 route 的功能。 ss：Socket Statistics 的缩写，和 netstat 类似，但是更快更强。 使用网络工具 # ifconfig 查看网卡 # 执行 ifconfig 查看网卡。
一般第一块网卡是 eth0。也可能是：
eno1 板载网卡 ens33 PCI-E 网卡 enp0s3 无法获取物理信息的 PCI-E 网卡 都不匹配就使用 eth0。
配置网卡名称 # 在管理服务器集群时，网卡名称不同，会不好管理。如何配置网卡名称？
首先，网卡命名规则受两个参数影响，分别是 biosdevname 和 net.ifnames。grup 是系统启动时，引导内核的工具。
编辑 /etc/default/grup 文件，在 GRUP_CMDLINE_LINUX 对应的命令后面添加（或修改）参数 biosdevname=0 net.ifnames=0，就可以传递到内核。 /etc/default/grup 需要运行 grup2-mkconfig -o /boot/grup2/grup."><meta property="og:type" content="article"><meta property="og:url" content="http://shipengqi.github.io/os-learn/docs/commands/06_network/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-09-08T13:17:58+08:00"><title>网络管理 | OS Learning</title><link rel=manifest href=/os-learn/manifest.json><link rel=icon href=/os-learn/favicon.png><link rel=stylesheet href=/os-learn/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/os-learn/flexsearch.min.js></script>
<script defer src=/os-learn/en.search.min.9da2651f3362f085ba92fedcac79d3065ce93b32c3817feded7d23b6337f4ee9.js integrity="sha256-naJlHzNi8IW6kv7crHnTBlzpOzLDgX/t7X0jtjN/Tuk=" crossorigin=anonymous></script>
<script defer src=/os-learn/sw.min.73e4e12d3b3ff9b5bd6410a479234d8908ebac0e4d11ef31f508715b8e7f7c7d.js integrity="sha256-c+ThLTs/+bW9ZBCkeSNNiQjrrA5NEe8x9QhxW45/fH0=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/os-learn/><span>OS Learning</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://shipengqi.github.io/ target=_blank rel=noopener>Blog</a></li><li><a href=https://github.com/shipengqi/os-learn target=_blank rel=noopener>Github</a></li></ul><ul><li><span>Linux 常用命令</span><ul><li><a href=/os-learn/docs/commands/01_view_text/>查看文件内容</a></li><li><a href=/os-learn/docs/commands/02_tar/>打包压缩</a></li><li><a href=/os-learn/docs/commands/03_vim/>Vim</a></li><li><a href=/os-learn/docs/commands/04_user_manage/>用户管理</a></li><li><a href=/os-learn/docs/commands/05_file_perm/>文件权限</a></li><li><a href=/os-learn/docs/commands/06_network/ class=active>网络管理</a></li><li><a href=/os-learn/docs/commands/07_package_manage/>包管理器</a></li><li><a href=/os-learn/docs/commands/08_grup/>grup</a></li><li><a href=/os-learn/docs/commands/09_process/>进程管理</a></li><li><a href=/os-learn/docs/commands/10_systemd/>systemctl</a></li><li><a href=/os-learn/docs/commands/11_selinux/>SELinux</a></li><li><a href=/os-learn/docs/commands/12_mem_disk/>内存和磁盘</a></li><li><a href=/os-learn/docs/commands/13_sar/>查看系统状态</a></li><li><a href=/os-learn/docs/commands/14_shell/>Shell</a></li><li><a href=/os-learn/docs/commands/15_script_priority/>脚本控制</a></li><li><a href=/os-learn/docs/commands/16_text_operation/>操作文本</a></li><li><a href=/os-learn/docs/commands/17_firewall/>防火墙</a></li><li><a href=/os-learn/docs/commands/18_ssh/>SSH</a></li><li><a href=/os-learn/docs/commands/19_ftp/>FTP</a></li><li><a href=/os-learn/docs/commands/20_nfs/>NFS</a></li><li><a href=/os-learn/docs/commands/21_dns/>DNS</a></li><li><a href=/os-learn/docs/commands/22_kernel_upgrade/>内核升级</a></li><li><a href=/os-learn/docs/commands/23_pty_tty/>pty</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/os-learn/svg/menu.svg class=book-icon alt=Menu></label>
<strong>网络管理</strong>
<label for=toc-control><img src=/os-learn/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#网络管理>网络管理</a><ul><li><a href=#net-tools>net-tools</a></li><li><a href=#iproute2>iproute2</a></li><li><a href=#使用网络工具>使用网络工具</a><ul><li><a href=#ifconfig-查看网卡>ifconfig 查看网卡</a></li><li><a href=#配置网卡名称>配置网卡名称</a></li><li><a href=#网线的连接状态>网线的连接状态</a></li><li><a href=#查看网关>查看网关</a></li><li><a href=#配置网卡>配置网卡</a></li><li><a href=#配置网关>配置网关</a></li><li><a href=#使用-ip-命令>使用 ip 命令</a></li></ul></li><li><a href=#网络故障排查>网络故障排查</a><ul><li><a href=#如何查看到目标主机的网络状态>如何查看到目标主机的网络状态</a></li><li><a href=#traceroute>traceroute</a></li><li><a href=#mtr>mtr</a></li><li><a href=#nslookup>nslookup</a></li><li><a href=#telnet>telnet</a></li><li><a href=#tcpdump>tcpdump</a></li><li><a href=#netstat>netstat</a></li><li><a href=#ss>ss</a></li></ul></li><li><a href=#网络服务管理>网络服务管理</a></li><li><a href=#配置文件>配置文件</a><ul><li><a href=#查看-network-状态>查看 network 状态</a></li><li><a href=#关闭-network-服务>关闭 network 服务</a></li><li><a href=#网卡配置文件>网卡配置文件</a></li><li><a href=#修改主机名>修改主机名</a></li></ul></li><li><a href=#linux-路由表>Linux 路由表</a><ul><li><a href=#route-命令>route 命令</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=网络管理>网络管理
<a class=anchor href=#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86>#</a></h1><p><code>net-tools</code> 是 CentOS 7 之前的版本使用的网络管理工具，而 <code>iproute2</code> 是 CentOS 7 之后主推的网络管理工具。</p><h2 id=net-tools>net-tools
<a class=anchor href=#net-tools>#</a></h2><p>net-tools 包括：</p><ul><li><code>ifconfig</code>：网卡配置。</li><li><code>route</code>：网关配置。</li><li><code>netstat</code>：查看网络状态。</li></ul><h2 id=iproute2>iproute2
<a class=anchor href=#iproute2>#</a></h2><ul><li><code>ip</code>：包含了 <code>ifconfig</code> 和 <code>route</code> 的功能。</li><li><code>ss</code>：Socket Statistics 的缩写，和 <code>netstat</code> 类似，但是更快更强。</li></ul><h2 id=使用网络工具>使用网络工具
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e7%bd%91%e7%bb%9c%e5%b7%a5%e5%85%b7>#</a></h2><h3 id=ifconfig-查看网卡>ifconfig 查看网卡
<a class=anchor href=#ifconfig-%e6%9f%a5%e7%9c%8b%e7%bd%91%e5%8d%a1>#</a></h3><p>执行 <code>ifconfig</code> 查看网卡。</p><p>一般第一块网卡是 <code>eth0</code>。也可能是：</p><ul><li><code>eno1</code> 板载网卡</li><li><code>ens33</code> PCI-E 网卡</li><li><code>enp0s3</code> 无法获取物理信息的 PCI-E 网卡</li></ul><p>都不匹配就使用 <code>eth0</code>。</p><h3 id=配置网卡名称>配置网卡名称
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e7%bd%91%e5%8d%a1%e5%90%8d%e7%a7%b0>#</a></h3><p>在管理服务器集群时，网卡名称不同，会不好管理。如何配置网卡名称？</p><p>首先，网卡命名规则受两个参数影响，分别是 <code>biosdevname</code> 和 <code>net.ifnames</code>。grup 是系统启动时，引导内核的工具。</p><ol><li>编辑 <code>/etc/default/grup</code> 文件，在 <code>GRUP_CMDLINE_LINUX</code> 对应的命令后面添加（或修改）参数 <code>biosdevname=0 net.ifnames=0</code>，就可以传递到内核。</li><li><code>/etc/default/grup</code> 需要运行 <code>grup2-mkconfig -o /boot/grup2/grup.cfg</code> 才会更新 grup，被内核读取。</li><li><code>reboot</code></li></ol><p>规则：</p><table><thead><tr><th>biosdevname</th><th>net.ifnames</th><th>网卡名</th></tr></thead><tbody><tr><td>0</td><td>1</td><td>ens33（default）</td></tr><tr><td>1</td><td>0</td><td>em1</td></tr><tr><td>0</td><td>0</td><td>eth0</td></tr></tbody></table><h3 id=网线的连接状态>网线的连接状态
<a class=anchor href=#%e7%bd%91%e7%ba%bf%e7%9a%84%e8%bf%9e%e6%8e%a5%e7%8a%b6%e6%80%81>#</a></h3><p><code>mii-tool &lt;网卡名称></code>。</p><h3 id=查看网关>查看网关
<a class=anchor href=#%e6%9f%a5%e7%9c%8b%e7%bd%91%e5%85%b3>#</a></h3><p><code>route</code>，常用命令是 <code>route -n</code>，因为 <code>route</code> 会尝试解析主机名，也就是将 IP 转换为域名，可能耗时较长。</p><h3 id=配置网卡>配置网卡
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e7%bd%91%e5%8d%a1>#</a></h3><ul><li><code>ifconfig &lt;网卡> &lt;IP> [netmask 子网掩码]</code> 配置网卡的 IP。注意如果是远程登录，修改 IP，可能会直接断开连接。</li><li><code>ifup &lt;网卡></code> 启动网卡</li><li><code>ifdown &lt;网卡></code> 关闭网卡</li></ul><h3 id=配置网关>配置网关
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e7%bd%91%e5%85%b3>#</a></h3><ul><li><code>route add default gw &lt;网关 IP></code> 添加默认网关</li><li><code>route add -host &lt;IP> gw &lt;网关 IP></code> 添加路由，访问指定 IP 时，使用指定的网关</li><li><code>route add -net &lt;网段> netmask &lt;子网掩码> gw &lt;网关 IP></code> 添加路由，访问指定网段时，使用指定网关</li><li><code>route del default gw &lt;网关 IP></code> 删除默认网关</li></ul><h3 id=使用-ip-命令>使用 ip 命令
<a class=anchor href=#%e4%bd%bf%e7%94%a8-ip-%e5%91%bd%e4%bb%a4>#</a></h3><ul><li><code>ip addr ls</code> 相当于 <code>ifconfig</code></li><li><code>ip link set dev eth0 up</code> 相当于 <code>ifup eth0</code></li><li><code>ip addr add 10.0.0.1/24 dev eth1</code> 相当于 <code>ifconfig eth1 netmask 255.255.255.0</code></li><li><code>ip route add 10.0.0.1/24 via 192.168.0.1</code> 相当于 <code>route add -net 10.0.0.0 netmask 255.255.255.0 gw 192.168.0.1</code>。</li></ul><h2 id=网络故障排查>网络故障排查
<a class=anchor href=#%e7%bd%91%e7%bb%9c%e6%95%85%e9%9a%9c%e6%8e%92%e6%9f%a5>#</a></h2><ul><li><code>ping</code></li><li><code>traceroute</code></li><li><code>mtr</code></li><li><code>nslookup</code></li><li><code>telnet</code></li><li><code>tcpdump</code></li><li><code>netstat</code></li><li><code>ss</code></li></ul><h3 id=如何查看到目标主机的网络状态>如何查看到目标主机的网络状态
<a class=anchor href=#%e5%a6%82%e4%bd%95%e6%9f%a5%e7%9c%8b%e5%88%b0%e7%9b%ae%e6%a0%87%e4%b8%bb%e6%9c%ba%e7%9a%84%e7%bd%91%e7%bb%9c%e7%8a%b6%e6%80%81>#</a></h3><ol><li>使用 <code>ping &lt;IP 或者 域名></code> 查看网络是否是通的。</li><li><code>traceroute</code> 和 <code>mtr</code> 辅助 <code>ping</code> 命令，在 <code>ping</code> 通网络之后，如果网络通信还是有问题，可以使用 <code>traceroute</code> 可以查看网络中每一跳的网络质量。<code>mtr</code> 可以检测网络中是否有丢包。</li><li><code>nslookup</code> 查看域名对应的 IP。</li><li>如果主机可以连接，但是服务仍然无法访问，使用 <code>telnet</code> 检查端口状态。</li><li>如果端口没有问题，仍然无法访问，可以使用 <code>tcpdump</code> 进行抓包，更细致的查看网络问题。</li><li>使用 <code>netstat</code> 和 <code>ss</code>，查看服务范围。</li></ol><h3 id=traceroute>traceroute
<a class=anchor href=#traceroute>#</a></h3><ul><li><code>traceroute -w 1 www.baidu.com</code>，<code>-w 1</code> wait，表示某个 IP 超时的最大等待时间为 1 秒。<ul><li><code>-n</code> 显示 IP 地址</li><li><code>-m</code> 设置检测数据包的最大存活数值 TTL 的大小</li><li><code>-q</code> 每个网关发送数据包个数</li><li><code>-p</code> UDP 端口</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># traceroute -w 1 www.baidu.com</span>
</span></span><span style=display:flex><span>traceroute to www.baidu.com <span style=color:#f92672>(</span>104.193.88.77<span style=color:#f92672>)</span>, <span style=color:#ae81ff>30</span> hops max, <span style=color:#ae81ff>60</span> byte packets
</span></span><span style=display:flex><span> <span style=color:#ae81ff>1</span>  gateway <span style=color:#f92672>(</span>16.155.192.1<span style=color:#f92672>)</span>  0.525 ms  0.635 ms  0.800 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span>  10.132.24.193 <span style=color:#f92672>(</span>10.132.24.193<span style=color:#f92672>)</span>  0.600 ms  0.930 ms  1.137 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>3</span>  192.168.201.122 <span style=color:#f92672>(</span>192.168.201.122<span style=color:#f92672>)</span>  0.826 ms  0.746 ms  0.674 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>4</span>  192.168.200.45 <span style=color:#f92672>(</span>192.168.200.45<span style=color:#f92672>)</span>  2.045 ms  1.978 ms  1.962 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>5</span>  192.168.203.249 <span style=color:#f92672>(</span>192.168.203.249<span style=color:#f92672>)</span>  29.375 ms  29.351 ms  29.275 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>6</span>  192.168.203.250 <span style=color:#f92672>(</span>192.168.203.250<span style=color:#f92672>)</span>  3.892 ms  2.980 ms  2.907 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>7</span>  192.168.200.185 <span style=color:#f92672>(</span>192.168.200.185<span style=color:#f92672>)</span>  68.675 ms  68.636 ms  68.691 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>8</span>  192.168.200.186 <span style=color:#f92672>(</span>192.168.200.186<span style=color:#f92672>)</span>  70.094 ms  70.356 ms  69.995 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>9</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>10</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>11</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>12</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>13</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>14</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>15</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>16</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>17</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>18</span>  * * *
</span></span><span style=display:flex><span><span style=color:#ae81ff>19</span>  * * *
</span></span></code></pre></div><p><code>*</code> 表示不支持 <code>traceroute</code> 追踪。</p><p>记录按序列号从 1 开始，每个纪录就是一跳 ，每跳表示一个网关，可以看到每行有三个时间，单位是 ms，之所以是 3 个，其实就是 <code>-q</code> 的默认参数。探测数据包向每个网关发送三个数据包后，网关响应后返回的时间。</p><h3 id=mtr>mtr
<a class=anchor href=#mtr>#</a></h3><p>运行 <code>mtr</code> 可以查看更详细的网络状态：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>                                                My traceroute  <span style=color:#f92672>[</span>v0.85<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>shcCDFrh75vm8.hpeswlab.net <span style=color:#f92672>(</span>0.0.0.0<span style=color:#f92672>)</span>                                                         Thu Aug <span style=color:#ae81ff>20</span> 22:02:41 <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>Keys:  Help   Display mode   Restart statistics   Order of fields   quit
</span></span><span style=display:flex><span>                                                                             Packets               Pings
</span></span><span style=display:flex><span> Host                                                                      Loss%   Snt   Last   Avg  Best  Wrst StDev
</span></span><span style=display:flex><span> 1. localhost                                                               0.0%     <span style=color:#ae81ff>3</span>    0.1   0.1   0.1   0.1   0.0
</span></span></code></pre></div><p>由于没有与当前主机进行通信，所以只显示了 <code>localhost</code> 的状态。</p><ul><li><code>Host</code>：IP 地址和域名，按 n 键可以切换 IP 和域名</li><li><code>Loss</code> 表示丢包率。</li><li><code>Snt</code>：设置每秒发送数据包的数量，默认值是 10 可以通过参数 <code>-c</code> 来指定</li><li><code>Last</code>：最近一次的 ping 值</li><li><code>Avg</code>：是平均值 发送 ping 包的平均时延</li><li><code>Best</code>：是最好或者说时延最短的</li><li><code>Wrst</code>：是最差或者说时延最长的</li><li><code>StDev</code>：标准偏差</li></ul><h3 id=nslookup>nslookup
<a class=anchor href=#nslookup>#</a></h3><p><code>nslookup &lt;域名></code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># nslookup www.baidu.com</span>
</span></span><span style=display:flex><span>Server:  16.187.185.202
</span></span><span style=display:flex><span>Address: 16.187.185.202#53
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Non-authoritative answer:
</span></span><span style=display:flex><span>www.baidu.com canonical name <span style=color:#f92672>=</span> www.a.shifen.com.  <span style=color:#75715e># 别名</span>
</span></span><span style=display:flex><span>www.a.shifen.com canonical name <span style=color:#f92672>=</span> www.wshifen.com.
</span></span><span style=display:flex><span>Name: www.wshifen.com
</span></span><span style=display:flex><span>Address: 104.193.88.77
</span></span><span style=display:flex><span>Name: www.wshifen.com
</span></span><span style=display:flex><span>Address: 104.193.88.123
</span></span></code></pre></div><p><code>Server</code> 域名解析服务器 IP。</p><h3 id=telnet>telnet
<a class=anchor href=#telnet>#</a></h3><p><code>telnet &lt;IP 或 域名> &lt;端口></code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@SGDLITVM0905 ~<span style=color:#f92672>]</span><span style=color:#75715e># telnet www.baidu.com 80</span>
</span></span><span style=display:flex><span>Trying 104.193.88.77...
</span></span><span style=display:flex><span>Connected to www.baidu.com.
</span></span><span style=display:flex><span>Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
</span></span></code></pre></div><p>上面的示例说明端口是通的，输入 <code>quit</code> 退出。</p><h3 id=tcpdump>tcpdump
<a class=anchor href=#tcpdump>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># tcpdump</span>
</span></span><span style=display:flex><span>tcpdump: verbose output suppressed, use -v or -vv <span style=color:#66d9ef>for</span> full protocol decode
</span></span><span style=display:flex><span>listening on virbr0, link-type EN10MB <span style=color:#f92672>(</span>Ethernet<span style=color:#f92672>)</span>, capture size <span style=color:#ae81ff>262144</span> bytes
</span></span></code></pre></div><p>抓到的数据包会实时显示出来。</p><p>常用的操作：</p><ul><li><code>tcpdump -i eth1</code> 监听指定网口的数据包。不指定的情况下默认监听第一个网口，一般是 eth0。</li><li><code>tcpdump -i any -n</code> 监听所有网口的数据包。<code>-n</code> 不解析域名。</li><li><code>tcpdump host 192.155.17.1</code> ，截获所有 IP 为 <code>192.155.17.1</code> 的主机接收和发送的所有数据包。</li><li><code>tcpdump -c 20</code> 截获 20 个数据包就结束。<code>-c</code> 指定数据包的数量。</li><li><code>tcpdump -i eth0 src host hostname></code> 截获从主机 hostname 发送的所有数据包</li><li><code>tcpdump -i eth0 src host hostname</code> 监听所有发送到主机 hostname 的数据包</li><li><code>tcpdump udp port 123</code> 监听 123 端口的 udp 数据包。就是监听 ntp 的服务端口。</li><li><code>tcpdump tcp port 23 and host 192.155.17.1</code> 监听 23 端口，从主机 192.155.17.1 接收或发出的 tcp 数据包。就是监听 telnet 包。</li><li><code>tcpdump tcp port 23 and host 192.155.17.1 -w /tmp/test.dump</code>，<code>-w</code> 表示包截获的数据 dump 到文件中。</li></ul><h3 id=netstat>netstat
<a class=anchor href=#netstat>#</a></h3><p>查看 Linux 中网络系统状态信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># netstat -ntp</span>
</span></span><span style=display:flex><span>Active Internet connections <span style=color:#f92672>(</span>w/o servers<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 16.155.194.49:22        10.5.41.247:57470       ESTABLISHED 394/sshd: root@pts/
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 16.155.194.49:22        10.5.41.247:64890       ESTABLISHED 25497/sshd: root@pt
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 16.155.194.49:22        10.5.41.247:57450       ESTABLISHED 6479/sshd: root@not
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>180</span> 16.155.194.49:22        15.122.72.86:51641      ESTABLISHED 25305/sshd: root@pt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># netstat -ntpl</span>
</span></span><span style=display:flex><span>Active Internet connections <span style=color:#f92672>(</span>only servers<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 127.0.0.1:6012          0.0.0.0:*               LISTEN      25305/sshd: root@pt
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 0.0.0.0:2049            0.0.0.0:*               LISTEN      -
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 0.0.0.0:45060           0.0.0.0:*               LISTEN      -
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 0.0.0.0:111             0.0.0.0:*               LISTEN      791/rpcbind
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 0.0.0.0:20048           0.0.0.0:*               LISTEN      1341/rpc.mountd
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 192.168.122.1:53        0.0.0.0:*               LISTEN      1832/dnsmasq
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 0.0.0.0:50037           0.0.0.0:*               LISTEN      1325/rpc.statd
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      1320/sshd
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 127.0.0.1:631           0.0.0.0:*               LISTEN      1321/cupsd
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 127.0.0.1:25            0.0.0.0:*               LISTEN      1674/master
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 127.0.0.1:6010          0.0.0.0:*               LISTEN      25497/sshd: root@pt
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 127.0.0.1:6011          0.0.0.0:*               LISTEN      394/sshd: root@pts/
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> ::1:6012                :::*                    LISTEN      25305/sshd: root@pt
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::35712                :::*                    LISTEN      1325/rpc.statd
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::2049                 :::*                    LISTEN      -
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::36773                :::*                    LISTEN      -
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::111                  :::*                    LISTEN      791/rpcbind
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::20048                :::*                    LISTEN      1341/rpc.mountd
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::22                   :::*                    LISTEN      1320/sshd
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> ::1:631                 :::*                    LISTEN      1321/cupsd
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> ::1:6010                :::*                    LISTEN      25497/sshd: root@pt
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> ::1:6011                :::*                    LISTEN      394/sshd: root@pts/
</span></span></code></pre></div><p>常用的参数：</p><ul><li><code>-n</code> 不解析域名</li><li><code>-p</code> 显示进程号</li><li><code>-l</code> 显示监听（LISTEN）服务</li><li><code>-t</code> 显示 tcp 协议</li><li><code>-i</code> 显示网卡列表</li></ul><h3 id=ss>ss
<a class=anchor href=#ss>#</a></h3><p>属于 iproute2 工具包，类似 <code>netstat</code>，参数类似，显示格式不同。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># ss -ntpl</span>
</span></span><span style=display:flex><span>State      Recv-Q Send-Q              Local Address:Port                             Peer Address:Port
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                     127.0.0.1:6012                                        *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;sshd&#34;</span>,pid<span style=color:#f92672>=</span>25305,fd<span style=color:#f92672>=</span>9<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>64</span>                              *:2049                                        *:*
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>64</span>                              *:45060                                       *:*
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                             *:111                                         *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;rpcbind&#34;</span>,pid<span style=color:#f92672>=</span>791,fd<span style=color:#f92672>=</span>8<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                             *:20048                                       *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;rpc.mountd&#34;</span>,pid<span style=color:#f92672>=</span>1341,fd<span style=color:#f92672>=</span>8<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>5</span>                   192.168.122.1:53                                          *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;dnsmasq&#34;</span>,pid<span style=color:#f92672>=</span>1832,fd<span style=color:#f92672>=</span>6<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                             *:50037                                       *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;rpc.statd&#34;</span>,pid<span style=color:#f92672>=</span>1325,fd<span style=color:#f92672>=</span>8<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                             *:22                                          *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;sshd&#34;</span>,pid<span style=color:#f92672>=</span>1320,fd<span style=color:#f92672>=</span>3<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                     127.0.0.1:631                                         *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;cupsd&#34;</span>,pid<span style=color:#f92672>=</span>1321,fd<span style=color:#f92672>=</span>12<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>100</span>                     127.0.0.1:25                                          *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;master&#34;</span>,pid<span style=color:#f92672>=</span>1674,fd<span style=color:#f92672>=</span>13<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                     127.0.0.1:6010                                        *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;sshd&#34;</span>,pid<span style=color:#f92672>=</span>25497,fd<span style=color:#f92672>=</span>9<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                     127.0.0.1:6011                                        *:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;sshd&#34;</span>,pid<span style=color:#f92672>=</span>394,fd<span style=color:#f92672>=</span>9<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                           ::1:6012                                       :::*
</span></span></code></pre></div><h2 id=网络服务管理>网络服务管理
<a class=anchor href=#%e7%bd%91%e7%bb%9c%e6%9c%8d%e5%8a%a1%e7%ae%a1%e7%90%86>#</a></h2><ul><li><code>service network start|stop|restart|status</code></li><li><code>chkconfig --list network</code></li><li><code>systemctl list-unit-files NetworkManager.service</code></li><li><code>systemctl start|stop|restart|status NetworkManager</code></li><li><code>systemctl enable|disable NetworkManager</code></li></ul><p>CentOS 7 中，systemctl 是 service 的替代品。</p><p>network 和 NetworkManager 是两套网络管理工具，应该只使用其中一套，禁用另一套。CentOS 6 之前只有 network 服务。</p><h2 id=配置文件>配置文件
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6>#</a></h2><ul><li><code>/etc/sysconfig/network-scripts/ifcfg-eth0</code> 网卡配置文件，名称是动态的。<code>eth0</code> 对应的是网卡的名称。</li><li><code>/etc/hosts</code> host 文件。</li></ul><h3 id=查看-network-状态>查看 network 状态
<a class=anchor href=#%e6%9f%a5%e7%9c%8b-network-%e7%8a%b6%e6%80%81>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># service network status</span>
</span></span><span style=display:flex><span>Configured devices:
</span></span><span style=display:flex><span>lo Profile_1 ens32
</span></span><span style=display:flex><span>Currently active devices:
</span></span><span style=display:flex><span>lo ens32 virbr0 docker0
</span></span></code></pre></div><p>重新初始化设置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># service network restart</span>
</span></span><span style=display:flex><span>Restarting network <span style=color:#f92672>(</span>via systemctl<span style=color:#f92672>)</span> <span style=color:#75715e># 其实还是使用的 systemctl</span>
</span></span></code></pre></div><p>这条命令会还原之前使用命令做的配置。</p><p>使用 systemctl 管理 NetworkManager。</p><p>查看服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl list-unit-files NetworkManager.service</span>
</span></span><span style=display:flex><span>UNIT FILE              STATE  
</span></span><span style=display:flex><span>NetworkManager.service enabled
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> unit files listed.
</span></span></code></pre></div><h3 id=关闭-network-服务>关闭 network 服务
<a class=anchor href=#%e5%85%b3%e9%97%ad-network-%e6%9c%8d%e5%8a%a1>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># chkconfig --list network   # 查看</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Note: This output shows SysV services only and does not include native
</span></span><span style=display:flex><span>      systemd services. SysV configuration data might be overridden by native
</span></span><span style=display:flex><span>      systemd configuration.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      If you want to list systemd services use <span style=color:#e6db74>&#39;systemctl list-unit-files&#39;</span>.
</span></span><span style=display:flex><span>      To see services enabled on particular target use
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;systemctl list-dependencies [target]&#39;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>network         0:off 1:off 2:on 3:on 4:on 5:on 6:off
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 ~<span style=color:#f92672>]</span><span style=color:#75715e># chkconfig --level 2345 network off # 禁用</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Note: This output shows SysV services only and does not include native
</span></span><span style=display:flex><span>      systemd services. SysV configuration data might be overridden by native
</span></span><span style=display:flex><span>      systemd configuration.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      If you want to list systemd services use <span style=color:#e6db74>&#39;systemctl list-unit-files&#39;</span>.
</span></span><span style=display:flex><span>      To see services enabled on particular target use
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;systemctl list-dependencies [target]&#39;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>network         0:off 1:off 2:on 3:on 4:on 5:on 6:off
</span></span></code></pre></div><h3 id=网卡配置文件>网卡配置文件
<a class=anchor href=#%e7%bd%91%e5%8d%a1%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm8 network-scripts<span style=color:#f92672>]</span><span style=color:#75715e># cat ifcfg-ens32</span>
</span></span><span style=display:flex><span>HWADDR<span style=color:#f92672>=</span>00:50:56:b0:71:0e
</span></span><span style=display:flex><span>NAME<span style=color:#f92672>=</span>ens32
</span></span><span style=display:flex><span>DEVICE<span style=color:#f92672>=</span>ens32
</span></span><span style=display:flex><span>DNS1<span style=color:#f92672>=</span>16.187.185.201
</span></span><span style=display:flex><span>DNS2<span style=color:#f92672>=</span>16.187.185.202
</span></span><span style=display:flex><span>DOMAIN<span style=color:#f92672>=</span>hpeswlab.net
</span></span><span style=display:flex><span>ONBOOT<span style=color:#f92672>=</span>yes      <span style=color:#75715e># 开机时是否启用该网卡</span>
</span></span><span style=display:flex><span>USERCTL<span style=color:#f92672>=</span>no
</span></span><span style=display:flex><span>PEERDNS<span style=color:#f92672>=</span>no
</span></span><span style=display:flex><span>BOOTPROTO<span style=color:#f92672>=</span>dhcp  <span style=color:#75715e># dhcp 动态分配 IP ，&#34;none&#34; 静态 IP</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  静态 IP 需要的配置</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#IPADDR=&lt;IP&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#NETMASK=&lt;子网掩码&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#GATEWAY=&lt;网关 IP&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>check_link_down<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> 1;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ZONE<span style=color:#f92672>=</span>public
</span></span></code></pre></div><p>使配置生效：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>service network restart
</span></span><span style=display:flex><span><span style=color:#75715e># 或者</span>
</span></span><span style=display:flex><span>systemctl restart NetworkManager
</span></span></code></pre></div><h3 id=修改主机名>修改主机名
<a class=anchor href=#%e4%bf%ae%e6%94%b9%e4%b8%bb%e6%9c%ba%e5%90%8d>#</a></h3><p>执行 <code>hostname</code> 可以查看当前主机名。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 临时修改主机名</span>
</span></span><span style=display:flex><span>hostname pooky75vm8.lab.net
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 永久生效，重启也不会改变</span>
</span></span><span style=display:flex><span>hostnamectl set-hostname pooky75vm8.lab.net
</span></span></code></pre></div><p>有些服务是依赖主机名的，修改主机名会影响这些服务。需要修改 host 文件 <code>/etc/hosts</code>，添加一行映射：<code>127.0.0.1 pooky75vm8.lab.net</code>。</p><p>否则某些服务启动时，可能会卡住。</p><h2 id=linux-路由表>Linux 路由表
<a class=anchor href=#linux-%e8%b7%af%e7%94%b1%e8%a1%a8>#</a></h2><p>指记录路由信息的表(可以单路由表，也可以多路由表)。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm7 container<span style=color:#f92672>]</span><span style=color:#75715e># route</span>
</span></span><span style=display:flex><span>Kernel IP routing table
</span></span><span style=display:flex><span>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span></span><span style=display:flex><span>default         gateway         0.0.0.0         UG    <span style=color:#ae81ff>100</span>    <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> ens32
</span></span><span style=display:flex><span>16.155.192.0    0.0.0.0         255.255.248.0   U     <span style=color:#ae81ff>100</span>    <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> ens32
</span></span><span style=display:flex><span>192.168.99.0    0.0.0.0         255.255.255.0   U     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> testbridge
</span></span><span style=display:flex><span>192.168.122.0   0.0.0.0         255.255.255.0   U     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> virbr0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm7 container<span style=color:#f92672>]</span><span style=color:#75715e># route -n # 查看默认路由表</span>
</span></span><span style=display:flex><span>Kernel IP routing table
</span></span><span style=display:flex><span>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span></span><span style=display:flex><span>0.0.0.0         16.155.192.1    0.0.0.0         UG    <span style=color:#ae81ff>100</span>    <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> ens32
</span></span><span style=display:flex><span>16.155.192.0    0.0.0.0         255.255.248.0   U     <span style=color:#ae81ff>100</span>    <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> ens32
</span></span><span style=display:flex><span>192.168.99.0    0.0.0.0         255.255.255.0   U     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> testbridge
</span></span><span style=display:flex><span>192.168.122.0   0.0.0.0         255.255.255.0   U     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> virbr0
</span></span></code></pre></div><table><thead><tr><th>列</th><th>描述</th></tr></thead><tbody><tr><td>Destination</td><td>目标网络或目标主机。当值为 <code>default</code>（<code>0.0.0.0</code>）时，表示这个是默认网关，所有数据都发到这个网关</td></tr><tr><td>Gateway</td><td>网关地址，<code>0.0.0.0</code> 表示对应的 Destination 跟本机在同一个网段，通信时不需要经过网关</td></tr><tr><td>Genmask</td><td>Destination 的子网掩码，Destination 是主机时需要设置为 <code>255.255.255.255</code>，是默认路由时会设置为 <code>0.0.0.0</code></td></tr><tr><td>Flags</td><td>标记</td></tr><tr><td>Metric</td><td>路由距离，到达指定网络所需的中转数</td></tr><tr><td>Ref</td><td>路由项引用次数</td></tr><tr><td>Use</td><td>此路由项被路由软件查找的次数</td></tr><tr><td>Iface</td><td>网卡名字</td></tr></tbody></table><p>Flags 含义：</p><ul><li><code>U</code> 路由是活动的</li><li><code>H</code> 目标是个主机</li><li><code>G</code> 需要经过网关</li><li><code>R</code> 恢复动态路由产生的表项</li><li><code>D</code> 由路由的后台程序动态地安装</li><li><code>M</code> 由路由的后台程序修改</li><li><code>!</code> 拒绝路由</li></ul><p>当在一台 linux 机器上要访问一个目标 ip 时：</p><ul><li>如果本机有目标 ip，则会直接访问本地;</li><li>如果本地没有目标 ip<ol><li>用 <code>route -n</code> 查看路由，如果路由条目里包含了目标 ip 的网段，则数据包就会从对应路由条目后面的网卡出去</li><li>如果没有对应网段的路由条目，则全部都走网关</li><li>如果网关也没有，则报错：网络不可达</li></ol></li></ul><p>因为本机 ens32 这个网卡有 <code>16.155.192.0/21</code> 这个网段的 IP，所以就会默认产生类似下面的路由条目</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>16.155.192.0    0.0.0.0         255.255.248.0   U     <span style=color:#ae81ff>100</span>    <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span> ens32
</span></span></code></pre></div><p>ens32 网卡的 IP：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@shcCDFrh75vm7 container<span style=color:#f92672>]</span><span style=color:#75715e># ip addr</span>
</span></span><span style=display:flex><span>2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc pfifo_fast state UP group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 00:50:56:b0:31:14 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 16.155.197.5/21 brd 16.155.199.255 scope global noprefixroute dynamic ens32
</span></span><span style=display:flex><span>       valid_lft 118238sec preferred_lft 118238sec
</span></span><span style=display:flex><span>    inet6 fe80::6833:a88a:7b0f:285c/64 scope link noprefixroute
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>那么根据规则和上面的路由表，如果要访问 <code>16.155.192.11</code> 这个IP，会怎么走？</p><p>会通过 <code>16.155.192.0/255.255.248.0</code> 这个路由条目后面指示的 ens33 网卡去寻找 <code>16.155.192.11</code>。</p><p>如果要访问 <code>119.75.217.26</code> 这个 IP，请问会怎么走？</p><p>会通过网关 <code>16.155.192.1</code> 去寻找。</p><h3 id=route-命令>route 命令
<a class=anchor href=#route-%e5%91%bd%e4%bb%a4>#</a></h3><p>route 命令可以显示或设置 Linux 内核中的路由表，主要是静态路由。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># route  [add|del] [-net|-host] target [netmask Nm] [gw Gw] [[dev] If]</span>
</span></span></code></pre></div><ul><li><code>add</code>：增加一条路由规则</li><li><code>del</code>：删除一条路由规则</li><li><code>-net</code>：目的地址是一个网络</li><li><code>-host</code>：目的地址是一个主机</li><li><code>target</code>：目的网络或主机</li><li><code>netmask</code>：目的地址的网络掩码</li><li><code>gw</code>：路由数据包通过的网关</li><li><code>dev</code>：为路由指定的网络接口</li></ul><p>在 CentOS 中默认的内核配置已经包含了路由功能，但默认并没有在系统启动时启用此功能。开启 Linux 的路由功能可以通过调整内核的网络参数来实现。要
配置和调整内核参数可以使用 sysctl 命令。例如：要开启 Linux 内核的数据包转发功能可以使用如下的命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl -w net.ipv4.ip_forward<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>vi /etc/sysctl.conf
</span></span><span style=display:flex><span>net.ipv4.ip_forward <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看是否支持转发</span>
</span></span><span style=display:flex><span>sysctl net.ipv4.ip_forward
</span></span></code></pre></div><p>对于局域网中的 Linux 主机，要想访问 Internet，需要将局域网的网关 IP 地址设置为这个主机的默认路由。可以在 <code>/etc/rc.local</code> 中添加 route 命令来保证路由设置永久有效。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/shipengqi/os-learn/commit/f355fb8431a9e4c893cda1e6dde4dd3b1ddbc614 title='Last modified by PengQi Shi | September 8, 2024' target=_blank rel=noopener><img src=/os-learn/svg/calendar.svg class=book-icon alt=Calendar>
<span>September 8, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/shipengqi/os-learn/edit/master/content/docs/commands/06_network.md target=_blank rel=noopener><img src=/os-learn/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#网络管理>网络管理</a><ul><li><a href=#net-tools>net-tools</a></li><li><a href=#iproute2>iproute2</a></li><li><a href=#使用网络工具>使用网络工具</a><ul><li><a href=#ifconfig-查看网卡>ifconfig 查看网卡</a></li><li><a href=#配置网卡名称>配置网卡名称</a></li><li><a href=#网线的连接状态>网线的连接状态</a></li><li><a href=#查看网关>查看网关</a></li><li><a href=#配置网卡>配置网卡</a></li><li><a href=#配置网关>配置网关</a></li><li><a href=#使用-ip-命令>使用 ip 命令</a></li></ul></li><li><a href=#网络故障排查>网络故障排查</a><ul><li><a href=#如何查看到目标主机的网络状态>如何查看到目标主机的网络状态</a></li><li><a href=#traceroute>traceroute</a></li><li><a href=#mtr>mtr</a></li><li><a href=#nslookup>nslookup</a></li><li><a href=#telnet>telnet</a></li><li><a href=#tcpdump>tcpdump</a></li><li><a href=#netstat>netstat</a></li><li><a href=#ss>ss</a></li></ul></li><li><a href=#网络服务管理>网络服务管理</a></li><li><a href=#配置文件>配置文件</a><ul><li><a href=#查看-network-状态>查看 network 状态</a></li><li><a href=#关闭-network-服务>关闭 network 服务</a></li><li><a href=#网卡配置文件>网卡配置文件</a></li><li><a href=#修改主机名>修改主机名</a></li></ul></li><li><a href=#linux-路由表>Linux 路由表</a><ul><li><a href=#route-命令>route 命令</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>