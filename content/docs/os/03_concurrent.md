# 并发

线程类似于独立的进程，只有一点区别：它们共享地址空间，可以访问相同的数据。

单个线程的状态和进程状态非常类似，线程有程序计数器（PC），记录从哪里获取指令。有一组寄存器。从一个线程切换到另一个线程，必定发生上下文切换，类似进程间的上下文切换。进程将状态保存到**进程控制块**（Process Control Block，PCB）。**线程控制块**（Thread Control Block，TCB），保存每个线程的状态。
一点主要区别：**地址空间保持不变（即不需要切换当前使用的页表）**。

线程和进程的另一个主要区别：栈。传统的进程地址空间只有一个栈，一般位于地址空间的底部。

![](process-thread.jpg)

在多线程的进程中，每个线程独立运行，都有一个栈。所有位于栈上的变量、参数、返回值和其他放在栈上的东西，将被放置在有时称为**线程本地（thread-local）存储**的地方，即相关线程的栈。

**线程的运行顺序是不确定的**。

## 线程 API

- `pthread_create()` 创建线程
- `pthread_join()` 等待线程完成
- `pthread_mutex_lock()` 加锁
- `pthread_mutex_unlock()` 释放锁
- `pthread_cond_wait()` 使调用线程进入休眠状态。条件变量，当线程之间必须发生某种信号时，如果一个线程在等待另一个线程继续执行某些操作，条件变量就很有用
- `pthread_cond_signal()` 唤醒线程
